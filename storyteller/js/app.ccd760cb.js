(function(){"use strict";var e={3944:function(e,t,a){var l=a(5130),s=a(6768);const n={class:"app"};function o(e,t,a,l,o,i){const r=(0,s.g2)("ChatPage");return(0,s.uX)(),(0,s.CE)("div",n,[t[0]||(t[0]=(0,s.Lk)("header",{class:"app-header"},[(0,s.Lk)("h1",null,"MCTS")],-1)),(0,s.bF)(r)])}var i=a(4232);const r={class:"main-container"},c={class:"chat-container"},p={class:"chat-messages"},u={class:"message-group user-message"},d={class:"message-content user-content"},v={class:"message-bubble user-bubble"},h={class:"message-group ai-message"},f={class:"message-content ai-content"},g={class:"message-bubble ai-bubble"},m={class:"ai-response-content"},k={key:0,class:"text-block"},y=["onClick"],w={class:"code-block-info"},C={class:"code-block-title"},b={class:"code-block-preview-text"},L={key:0,class:"detail-panel"},T={key:1,class:"detail-panel"},E=["src"],x=["src"],P={class:"fullscreen-image-container"},$=["src"];function _(e,t,a,n,o,_){const F=(0,s.g2)("FileLinkDetector"),I=(0,s.g2)("StatusTimeline"),N=(0,s.g2)("TaskCard"),X=(0,s.g2)("FilePreview"),S=(0,s.g2)("CodeBlock"),D=(0,s.g2)("MarkdownPreview"),R=(0,s.g2)("DatasetPreview");return(0,s.uX)(),(0,s.CE)("div",r,[(0,s.Lk)("div",c,[(0,s.Lk)("div",p,[(0,s.Lk)("div",u,[(0,s.Lk)("div",d,[(0,s.Lk)("div",v,[(0,s.Lk)("p",null,(0,i.v_)(n.query),1)]),(0,s.Lk)("div",{class:"attachment-section",onClick:t[0]||(t[0]=(...e)=>n.toggleDatasetPreview&&n.toggleDatasetPreview(...e))},t[8]||(t[8]=[(0,s.Fv)('<div class="attachment-card" data-v-eaa257ba><div class="attachment-icon" data-v-eaa257ba>📊</div><div class="attachment-info" data-v-eaa257ba><div class="attachment-name" data-v-eaa257ba>shopping.csv</div><div class="attachment-meta" data-v-eaa257ba>Dataset • Click to view</div></div></div>',1)]))]),t[9]||(t[9]=(0,s.Lk)("div",{class:"avatar user-avatar"},[(0,s.Lk)("span",{class:"avatar-icon"},"👤")],-1))]),(0,s.Lk)("div",h,[t[12]||(t[12]=(0,s.Lk)("div",{class:"avatar ai-avatar"},[(0,s.Lk)("span",{class:"avatar-icon"},"🌲")],-1)),(0,s.Lk)("div",f,[(0,s.Lk)("div",g,[t[11]||(t[11]=(0,s.Lk)("p",null,"I'll analyze the differences between customers based on the shopping dataset.",-1)),(0,s.Lk)("div",m,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.displayedBlocks,((e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:a,class:"content-block"},["text"===e.type?((0,s.uX)(),(0,s.CE)("div",k,[(0,s.bF)(F,{content:e.content,onFilePreview:n.selectFile},null,8,["content","onFilePreview"])])):"code"===e.type?((0,s.uX)(),(0,s.CE)("div",{key:1,class:"code-block-preview",onClick:t=>n.selectCodeBlock(e)},[t[10]||(t[10]=(0,s.Lk)("div",{class:"code-block-icon"},"💻",-1)),(0,s.Lk)("div",w,[(0,s.Lk)("div",C,(0,i.v_)(e.isJson?"JSON Data":"Code Block"),1),(0,s.Lk)("div",b,(0,i.v_)(n.getCodePreview(e.content)),1)])],8,y)):"status-group"===e.type?((0,s.uX)(),(0,s.Wv)(I,{key:2,items:e.items,initialExpanded:e.expanded},null,8,["items","initialExpanded"])):"task-block"===e.type?((0,s.uX)(),(0,s.Wv)(N,{key:3,content:e.content,taskId:e.id},null,8,["content","taskId"])):"file"===e.type?((0,s.uX)(),(0,s.Wv)(X,{key:4,fileName:e.fileName,filePath:e.filePath,fileType:e.fileType,onPreview:n.selectFile},null,8,["fileName","filePath","fileType","onPreview"])):(0,s.Q3)("",!0)])))),128))])])])])])]),n.selectedCodeBlock?((0,s.uX)(),(0,s.CE)("div",L,[(0,s.bF)(S,{content:n.selectedCodeBlock.content,isJson:n.selectedCodeBlock.isJson},null,8,["content","isJson"]),(0,s.Lk)("button",{class:"close-btn",onClick:t[1]||(t[1]=(...e)=>n.closeCodeDetail&&n.closeCodeDetail(...e))},"×")])):(0,s.Q3)("",!0),n.selectedFile?((0,s.uX)(),(0,s.CE)("div",T,["markdown"===n.selectedFile.fileType||"report"===n.selectedFile.fileType?((0,s.uX)(),(0,s.Wv)(D,{key:0,filePath:n.selectedFile.filePath,fileName:n.selectedFile.fileName},null,8,["filePath","fileName"])):"html"===n.selectedFile.fileType?((0,s.uX)(),(0,s.CE)("iframe",{key:1,src:n.selectedFile.filePath,class:"html-preview",frameborder:"0"},null,8,E)):"image"===n.selectedFile.fileType?((0,s.uX)(),(0,s.CE)("img",{key:2,src:n.selectedFile.filePath,class:"image-preview",alt:"File preview"},null,8,x)):(0,s.Q3)("",!0),(0,s.Lk)("button",{class:"close-btn",onClick:t[2]||(t[2]=(...e)=>n.closeFilePreview&&n.closeFilePreview(...e))},"×")])):(0,s.Q3)("",!0),n.isDatasetPreviewVisible?((0,s.uX)(),(0,s.Wv)(R,{key:2,isLoading:n.isLoading,datasetError:n.datasetError,datasetHeaders:n.datasetHeaders,datasetRows:n.datasetRows,onClose:n.toggleDatasetPreview},null,8,["isLoading","datasetError","datasetHeaders","datasetRows","onClose"])):(0,s.Q3)("",!0),n.fullScreenImage?((0,s.uX)(),(0,s.CE)("div",{key:3,class:"fullscreen-overlay",onClick:t[4]||(t[4]=(...e)=>n.closeFullScreenImage&&n.closeFullScreenImage(...e))},[(0,s.Lk)("div",P,[(0,s.Lk)("img",{src:n.fullScreenImage,alt:"Fullscreen preview",class:"fullscreen-image"},null,8,$),(0,s.Lk)("button",{class:"close-button",onClick:t[3]||(t[3]=(0,l.D$)(((...e)=>n.closeFullScreenImage&&n.closeFullScreenImage(...e)),["stop"]))},"×")])])):(0,s.Q3)("",!0),(0,s.bo)((0,s.Lk)("div",{class:"back-to-top",onClick:t[5]||(t[5]=(...e)=>n.scrollToTop&&n.scrollToTop(...e))},t[13]||(t[13]=[(0,s.Lk)("div",{class:"back-to-top-icon"},"↑",-1)]),512),[[l.aG,n.showBackToTop]]),(0,s.Lk)("div",{class:"show-files-button",onClick:t[6]||(t[6]=(...e)=>n.scanIterationsDirectory&&n.scanIterationsDirectory(...e))},t[14]||(t[14]=[(0,s.Lk)("div",{class:"show-files-icon"},"📁",-1),(0,s.Lk)("div",{class:"tooltip"},"扫描文件",-1)])),n.isTypingComplete?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",{key:4,class:"skip-animation-button",onClick:t[7]||(t[7]=(...e)=>n.skipTypingAnimation&&n.skipTypingAnimation(...e))},t[15]||(t[15]=[(0,s.Lk)("div",{class:"skip-animation-icon"},"⏭️",-1),(0,s.Lk)("div",{class:"tooltip"},"跳过动画",-1)])))])}a(4114),a(8111),a(2489),a(116),a(7588),a(1701),a(8237),a(3579),a(7642),a(8004),a(3853),a(5876),a(2475),a(5024),a(1698);var F=a(144);const I={class:"dataset-modal"},N={class:"dataset-container"},X={class:"dataset-header"},S={class:"dataset-content"},D={key:0,class:"dataset-loading"},R={key:1,class:"dataset-error"},A={class:"error-message"},K={key:2,class:"dataset-table-wrapper"},M={class:"dataset-table"},j={key:3,class:"dataset-empty"};function B(e,t,a,l,n,o){return(0,s.uX)(),(0,s.CE)("div",I,[(0,s.Lk)("div",N,[(0,s.Lk)("div",X,[t[1]||(t[1]=(0,s.Lk)("h2",null,"Dataset Preview: shopping.csv",-1)),(0,s.Lk)("button",{class:"close-btn",onClick:t[0]||(t[0]=t=>e.$emit("close"))},"×")]),(0,s.Lk)("div",S,[a.isLoading?((0,s.uX)(),(0,s.CE)("div",D,t[2]||(t[2]=[(0,s.Lk)("div",{class:"loading-spinner"},null,-1),(0,s.Lk)("div",null,"Loading dataset...",-1)]))):a.datasetError?((0,s.uX)(),(0,s.CE)("div",R,[t[3]||(t[3]=(0,s.Lk)("div",{class:"error-icon"},"⚠️",-1)),(0,s.Lk)("div",A,(0,i.v_)(a.datasetError),1)])):a.datasetHeaders.length>0?((0,s.uX)(),(0,s.CE)("div",K,[(0,s.Lk)("table",M,[(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(a.datasetHeaders,((e,t)=>((0,s.uX)(),(0,s.CE)("th",{key:t},(0,i.v_)(e),1)))),128))])]),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(a.datasetRows,((e,t)=>((0,s.uX)(),(0,s.CE)("tr",{key:t},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e,((e,t)=>((0,s.uX)(),(0,s.CE)("td",{key:t},(0,i.v_)(e),1)))),128))])))),128))])])])):((0,s.uX)(),(0,s.CE)("div",j," No data available "))])])])}var H={name:"DatasetPreview",props:{isLoading:{type:Boolean,required:!0},datasetError:{type:String,default:null},datasetHeaders:{type:Array,required:!0},datasetRows:{type:Array,required:!0}},emits:["close"]},Q=a(1241);const O=(0,Q.A)(H,[["render",B],["__scopeId","data-v-25962510"]]);var q=O;const J={class:"code-block-header"},z={class:"code-block-title"},W={class:"code-type"},V={class:"code-block-actions"},Z={key:0,class:"code-block-content"};function G(e,t,a,l,n,o){return(0,s.uX)(),(0,s.CE)("div",{class:(0,i.C4)(["code-block-card",{collapsed:n.isCollapsed}])},[(0,s.Lk)("div",J,[(0,s.Lk)("div",z,[t[1]||(t[1]=(0,s.Lk)("div",{class:"code-icon"},"💻",-1)),(0,s.Lk)("div",W,(0,i.v_)(o.codeType),1)]),(0,s.Lk)("div",V,[(0,s.Lk)("button",{class:"collapse-btn",onClick:t[0]||(t[0]=(...e)=>o.toggleCollapse&&o.toggleCollapse(...e))},(0,i.v_)(n.isCollapsed?"expand":"collapse"),1)])]),n.isCollapsed?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",Z,[(0,s.Lk)("pre",null,[(0,s.Lk)("code",null,(0,i.v_)(a.content),1)])]))],2)}var Y={name:"CodeBlock",props:{content:{type:String,required:!0},isJson:{type:Boolean,default:!1}},data(){return{isCollapsed:!1}},computed:{codeType(){return this.isJson?"JSON Data":"Code"}},methods:{toggleCollapse(){this.isCollapsed=!this.isCollapsed}}};const U=(0,Q.A)(Y,[["render",G],["__scopeId","data-v-ceb189f4"]]);var ee=U;const te={class:"status-group-block"},ae={class:"status-group-title"},le={key:0},se={class:"step-count"},ne={class:"status-group-toggle"},oe={key:0,class:"status-timeline"},ie={class:"timeline-container"},re={class:"status-content"},ce={class:"status-icon"},pe={key:0},ue={key:1},de={class:"status-text"};function ve(e,t,a,l,n,o){return(0,s.uX)(),(0,s.CE)("div",te,[(0,s.Lk)("div",{class:"status-group-header",onClick:t[0]||(t[0]=(...e)=>o.toggleExpanded&&o.toggleExpanded(...e))},[t[1]||(t[1]=(0,s.Lk)("div",{class:"status-group-icon"},"📋",-1)),(0,s.Lk)("div",ae,[a.items.length>0&&a.items[0].content?((0,s.uX)(),(0,s.CE)("span",le,(0,i.v_)(o.getDisplayTitle(a.items[0].content)),1)):(0,s.Q3)("",!0),(0,s.Lk)("span",se,"("+(0,i.v_)(Math.floor(a.items.length/2))+"步)",1)]),(0,s.Lk)("div",ne,(0,i.v_)(n.expanded?"collapse":"expand"),1)]),n.expanded?((0,s.uX)(),(0,s.CE)("div",oe,[(0,s.Lk)("div",ie,[t[2]||(t[2]=(0,s.Lk)("div",{class:"timeline-line"},null,-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(a.items,((e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:"status-item"},[(0,s.Lk)("div",{class:(0,i.C4)(["status-marker",{completed:"generated"===e.status}])},null,2),(0,s.Lk)("div",re,[(0,s.Lk)("div",ce,["generating"===e.status?((0,s.uX)(),(0,s.CE)("span",pe,"⏳")):"generated"===e.status?((0,s.uX)(),(0,s.CE)("span",ue)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",de,(0,i.v_)(e.content),1)])])))),128))])])):(0,s.Q3)("",!0)])}var he={name:"StatusTimeline",props:{items:{type:Array,required:!0,default:()=>[]},initialExpanded:{type:Boolean,default:!1}},data(){return{expanded:this.initialExpanded}},methods:{toggleExpanded(){this.expanded=!this.expanded},getDisplayTitle(e){return e}}};const fe=(0,Q.A)(he,[["render",ve],["__scopeId","data-v-62b92465"]]);var ge=fe;const me={class:"task-card"},ke={class:"task-title"},ye={key:0,class:"task-id"},we={class:"expand-button"},Ce={key:0,class:"card-content"},be=["innerHTML"];function Le(e,t,a,l,n,o){return(0,s.uX)(),(0,s.CE)("div",me,[(0,s.Lk)("div",{class:"card-header",onClick:t[0]||(t[0]=(...e)=>o.toggleExpand&&o.toggleExpand(...e))},[t[2]||(t[2]=(0,s.Lk)("div",{class:"task-icon"},"🔍",-1)),(0,s.Lk)("div",ke,[t[1]||(t[1]=(0,s.eW)(" 处理任务: ")),o.displayId?((0,s.uX)(),(0,s.CE)("span",ye,(0,i.v_)(o.displayId),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",we,(0,i.v_)(n.isExpanded?"▼":"▶"),1)]),n.isExpanded?((0,s.uX)(),(0,s.CE)("div",Ce,[(0,s.Lk)("div",{class:"markdown-content",innerHTML:o.formattedContent},null,8,be)])):(0,s.Q3)("",!0)])}var Te=a(357),Ee={name:"TaskCard",props:{content:{type:String,required:!0},taskId:{type:String,default:""},initialExpanded:{type:Boolean,default:!0}},data(){return{isExpanded:this.initialExpanded}},computed:{extractedTaskId(){const e=this.content.match(/任务ID: ([^"'\n]+)/);if(e&&e[1])return e[1].trim();const t=this.content.match(/任务\s+'([^']+)'/);return t&&t[1]?t[1].trim():""},displayId(){return this.taskId||this.extractedTaskId},formattedContent(){try{return(0,Te.xI)(this.content)}catch(e){return`<pre>${this.content}</pre>`}}},methods:{toggleExpand(){this.isExpanded=!this.isExpanded}}};const xe=(0,Q.A)(Ee,[["render",Le],["__scopeId","data-v-8accfa84"]]);var Pe=xe;const $e={class:"markdown-preview"},_e={class:"markdown-header"},Fe={class:"markdown-title"},Ie=["innerHTML"],Ne={key:0,class:"loading-indicator"},Xe={key:1,class:"error-message"};function Se(e,t,a,l,n,o){return(0,s.uX)(),(0,s.CE)("div",$e,[(0,s.Lk)("div",_e,[(0,s.Lk)("h3",Fe,(0,i.v_)(e.fileName),1)]),(0,s.Lk)("div",{class:"markdown-content",innerHTML:e.renderedContent},null,8,Ie),e.isLoading?((0,s.uX)(),(0,s.CE)("div",Ne,"加载中...")):(0,s.Q3)("",!0),e.error?((0,s.uX)(),(0,s.CE)("div",Xe,(0,i.v_)(e.error),1)):(0,s.Q3)("",!0)])}const De=e=>{try{let l;try{return l=a(6709),l.parse(e)}catch(t){return console.warn("marked库未找到，使用简单格式化"),Re(e)}}catch(t){return console.error("Markdown渲染失败:",t),Re(e)}},Re=e=>{let t=e.replace(/</g,"&lt;").replace(/>/g,"&gt;");return t=t.replace(/^### (.*?)$/gm,"<h3>$1</h3>"),t=t.replace(/^## (.*?)$/gm,"<h2>$1</h2>"),t=t.replace(/^# (.*?)$/gm,"<h1>$1</h1>"),t=t.replace(/^\* (.*?)$/gm,"<li>$1</li>"),t=t.replace(/^- (.*?)$/gm,"<li>$1</li>"),t=t.replace(/^(\d+)\. (.*?)$/gm,"<li>$2</li>"),t=t.replace(/\n\n/g,"</p><p>"),t=t.replace(/```([\s\S]*?)```/g,"<pre><code>$1</code></pre>"),t=t.replace(/`([^`]+)`/g,"<code>$1</code>"),t=t.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),t=t.replace(/\*(.*?)\*/g,"<em>$1</em>"),t="<p>"+t+"</p>",t=t.replace(/<\/li><p>/g,"</li>"),t=t.replace(/<\/p><li>/g,"<li>"),t};var Ae=(0,s.pM)({name:"MarkdownPreview",props:{filePath:{type:String,required:!0},fileName:{type:String,required:!0}},setup(e){const t=(0,F.KR)(""),a=(0,F.KR)(!0),l=(0,F.KR)(null),n=async()=>{try{a.value=!0,l.value=null;const s=await fetch(e.filePath);if(!s.ok)throw new Error(`无法加载文件 (${s.status})`);const n=await s.text();t.value=De(n)}catch(s){console.error("加载Markdown文件失败:",s),l.value=`加载失败: ${s.message}`}finally{a.value=!1}};return(0,s.sV)((()=>{n()})),(0,s.wB)((()=>e.filePath),(()=>{n()})),{renderedContent:t,isLoading:a,error:l}}});const Ke=(0,Q.A)(Ae,[["render",Se],["__scopeId","data-v-1a232d32"]]);var Me=Ke;const je={class:"file-icon"},Be={class:"file-info"},He={class:"file-title"},Qe={class:"file-description"};function Oe(e,t,a,l,n,o){return(0,s.uX)(),(0,s.CE)("div",{class:"file-preview-card",onClick:t[0]||(t[0]=(...t)=>e.openPreview&&e.openPreview(...t))},[(0,s.Lk)("div",je,(0,i.v_)(e.getFileIcon(e.fileType)),1),(0,s.Lk)("div",Be,[(0,s.Lk)("div",He,(0,i.v_)(e.fileName),1),(0,s.Lk)("div",Qe,(0,i.v_)(e.getFileDescription(e.fileType))+" • 点击查看",1)])])}var qe=(0,s.pM)({name:"FilePreview",props:{fileName:{type:String,required:!0},filePath:{type:String,required:!0},fileType:{type:String,default:"other"}},emits:["preview"],setup(e,{emit:t}){const a=e=>{const t={markdown:"📝",report:"📊",html:"🌐",image:"🖼️",json:"📋",csv:"📈",other:"📄"};return t[e]||t.other},l=e=>{const t={markdown:"Markdown文档",report:"分析报告",html:"HTML页面",image:"图片文件",json:"JSON数据",csv:"数据表格",other:"文件"};return t[e]||t.other},s=()=>{t("preview",{fileName:e.fileName,filePath:e.filePath,fileType:e.fileType})};return{getFileIcon:a,getFileDescription:l,openPreview:s}}});const Je=(0,Q.A)(qe,[["render",Oe],["__scopeId","data-v-f4d5d650"]]);var ze=Je;const We={class:"file-link-detector"},Ve={key:0,class:"detected-files"},Ze={class:"file-links"},Ge=["onClick"],Ye={class:"file-icon"},Ue={class:"file-name"};function et(e,t,a,l,n,o){return(0,s.uX)(),(0,s.CE)("div",We,[(0,s.Lk)("div",{ref:"contentContainer",onClick:t[0]||(t[0]=(...t)=>e.handleTextClick&&e.handleTextClick(...t))},null,512),e.detectedFiles.length>0?((0,s.uX)(),(0,s.CE)("div",Ve,[t[1]||(t[1]=(0,s.Lk)("div",{class:"files-section-title"},"相关文件:",-1)),(0,s.Lk)("div",Ze,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.detectedFiles,((t,a)=>((0,s.uX)(),(0,s.CE)("div",{key:a,class:"file-link",onClick:a=>e.openFile(t)},[(0,s.Lk)("span",Ye,(0,i.v_)(e.getFileIcon(t.fileType)),1),(0,s.Lk)("span",Ue,(0,i.v_)(t.fileName),1)],8,Ge)))),128))])])):(0,s.Q3)("",!0)])}var tt=(0,s.pM)({name:"FileLinkDetector",props:{content:{type:String,required:!0}},emits:["file-preview"],setup(e,{emit:t}){const a=(0,F.KR)([]),l=(0,F.KR)(null),n=e=>{const t={markdown:"📝",report:"📊",html:"🌐",image:"🖼️",json:"📋",csv:"📈",other:"📄"};return t[e]||t.other},o=()=>{if(!l.value)return;let t=e.content;const s=/<[^>]+>/.test(t);s||(t=t.replace(/</g,"&lt;").replace(/>/g,"&gt;"),a.value.forEach((e=>{const l=e.originalMatch.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),s=new RegExp(l,"g");t=t.replace(s,`<span class="file-path-highlight" data-file-index="${a.value.indexOf(e)}">${e.originalMatch}</span>`)}))),l.value.innerHTML=t},i=e=>{if(e.target.classList.contains("file-path-highlight")){const t=parseInt(e.target.dataset.fileIndex);!isNaN(t)&&t>=0&&t<a.value.length&&c(a.value[t])}},r=async()=>{a.value=[];const t=e.content,l=[{pattern:/storyteller\/output(?:\/[\w.-]+)*\/([^/\s,，.。]+\.\w+)/g,type:"auto"},{pattern:/iterations\/([^/\s,，.。]+\.\w+)/g,type:"auto"},{pattern:/已保存到\s*(?:\/[\w.-]+)*\/([^/\s,，.。]+\.\w+)/g,type:"auto"},{pattern:/generated:\s*([a-zA-Z0-9_-]+\.\w+)/gi,type:"auto"}],s=[],n=t.split("\n");n.forEach((e=>{l.forEach((({pattern:t,type:a})=>{let l;while(null!==(l=t.exec(e)))if(l[1]){const e=l[1].trim().replace(/[,，.。"']/g,""),t="/storyteller/output/",n=`${t}${e}`;let o=a;if("auto"===a){const t=e.split(".").pop().toLowerCase();switch(t){case"md":o="markdown";break;case"html":o="html";break;case"png":case"jpg":case"jpeg":case"gif":case"svg":o="image";break;case"json":o="json";break;case"csv":o="csv";break;default:o="other"}}s.some((t=>t.fileName===e))||s.push({fileName:e,filePath:n,fileType:o,originalMatch:l[0]})}t.lastIndex=0}))}));for(const e of s)try{const t=await fetch(e.filePath,{method:"HEAD"});t.ok&&(a.value.push(e),console.log(`确认文件存在: ${e.filePath}`))}catch(i){console.error(`检查文件存在性失败: ${e.filePath}`,i)}o()},c=e=>{t("file-preview",e)};return(0,s.wB)((()=>e.content),(()=>{r()})),(0,s.sV)((()=>{r()})),(0,s.wB)(a,(()=>{o()})),{contentContainer:l,detectedFiles:a,getFileIcon:n,openFile:c,handleTextClick:i}}});const at=(0,Q.A)(tt,[["render",et],["__scopeId","data-v-6005c87b"]]);var lt=at,st={name:"ChatPage",components:{DatasetPreview:q,CodeBlock:ee,StatusTimeline:ge,TaskCard:Pe,MarkdownPreview:Me,FilePreview:ze,FileLinkDetector:lt},setup(){const e=(0,F.KR)("Analyze the difference between the customers"),t=(0,F.KR)(!1),a=(0,F.KR)([]),l=(0,F.KR)([]),n=(0,F.KR)(!1),o=(0,F.KR)(null),i=(0,F.KR)(null),r=(0,F.KR)(""),c=(0,F.KR)([]),p=(0,F.KR)([]),u=(0,F.KR)(!1),d=(0,F.KR)(20),v=(0,F.KR)(null),h=(0,F.KR)(!1),f=(0,F.KR)(null),g=(0,F.KR)([]),m=(0,F.KR)([]),k=(0,F.KR)([]),y=(0,F.KR)(0);let w=null;const C=e=>{v.value=e},b=()=>{v.value=null},L=e=>e.length<=80?e:e.substring(0,80)+"...",T=e=>{const t=/<span|<div|<p/i.test(e);if(t)return console.log("文本已包含HTML标签，直接返回"),e;const a=["Finding","available action","Trying action","MCTS search started","MCTS search completed","Iteration","Simulation","state","depth","Selected action","Executing action","Found"];let l=e.replace(/</g,"&lt;").replace(/>/g,"&gt;");const s=[{action:"Query2Chapters",className:"action-query-chapters"},{action:"ReviseVis",className:"action-revise"},{action:"Charts2Captions",className:"action-charts-captions"},{action:"Captions2Summaries",className:"action-captions-summaries"},{action:"Chapter2Tasks",className:"action-chapter-tasks"},{action:"Tasks2Charts",className:"action-tasks-charts"}];for(const n of s){let e=l.split(n.action);e.length>1&&(console.log(`替换动作 ${n.action}, 出现 ${e.length-1} 次`),l=e.join(`<span class="action-tag ${n.className}">${n.action}</span>`))}return a.forEach((e=>{const t=new RegExp(`(${e})`,"gi");l=l.replace(t,'<span class="highlight">$1</span>')})),l},E=e=>{i.value=e},x=()=>{i.value=null},P=async()=>{t.value=!t.value,t.value&&0===l.value.length&&await $()},$=async()=>{n.value=!0,o.value=null;try{const e=await fetch("/storyteller/dataset/shopping.csv");if(!e.ok)throw new Error(`Failed to load dataset (${e.status})`);const t=await e.text(),s=t.split("\n").filter((e=>""!==e.trim()));if(s.length>0){a.value=s[0].split(",").map((e=>e.trim()));const e=Math.min(s.length-1,100);l.value=s.slice(1,e+1).map((e=>e.split(",").map((e=>e.trim()))))}}catch(e){console.error("Error loading dataset:",e),o.value=e.message}finally{n.value=!1}};(0,s.sV)((async()=>{try{window.addEventListener("scroll",_);const e=await fetch("/storyteller/output/log.txt"),t=await e.text(),a=t.replace(/当前状态: ([A-Za-z0-9_.]+)/g,'<div class="state-wrapper"><span class="state-tag">当前状态: $1</span></div>');r.value=a,R(a),c.value.some((e=>"code"===e.type))?console.log("发现代码块:",c.value.filter((e=>"code"===e.type)).length):console.log("未找到代码块"),console.log("页面加载完成，自动执行文件扫描"),setTimeout((()=>{H()}),1e3)}catch(e){console.error("Failed to load log file:",e)}})),(0,s.hi)((()=>{window.removeEventListener("scroll",_),w&&clearInterval(w)}));const _=()=>{h.value=window.scrollY>300},I=()=>{if(0===m.value.length&&D(),u.value||0===m.value.length)return null;let e=!0;const t=()=>{const t=window.scrollY+window.innerHeight,a=document.body.scrollHeight-t<100;e=a,a?console.log("用户在底部，启用自动滚动"):console.log("用户不在底部，暂停自动滚动")};window.addEventListener("scroll",t),t();const a=setInterval((()=>{y.value<m.value.length?(N(),y.value++,e&&setTimeout((()=>{window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"})}),50)):(clearInterval(a),window.removeEventListener("scroll",t),u.value=!0,w=null,setTimeout((()=>{H()}),500))}),d.value);return w=a,a},N=()=>{const e=m.value[y.value];if("line"===e.type)k.value.push(e),X();else if("block-start"===e.type)k.value.push(e);else if("block-line"===e.type)k.value.push(e),X();else if("block-end"===e.type){k.value.push(e),X();const t=p.value[p.value.length-1];t&&"code"===t.type&&C(t)}else if("whole-block"===e.type){k.value.push(e),X();const t=p.value[p.value.length-1];t&&"code"===t.type&&C(t)}},X=()=>{const e=[];let t=null,a=[];k.value.forEach((l=>{if("line"===l.type)e.push({type:"text",content:l.content});else if("block-start"===l.type)t=l.block,a=[];else if("block-line"===l.type)a.push(l.content);else if("block-end"===l.type){if(t){const l={...t};l.content=a.join("\n"),e.push(l),t=null,a=[]}}else"whole-block"===l.type&&e.push(l.block)})),p.value=e},S=()=>{w&&clearInterval(w),p.value=[...c.value],u.value=!0,y.value=m.value.length,console.log("跳过动画，立即执行文件扫描"),H(),v.value&&setTimeout((()=>{b()}),500)},D=()=>{m.value=[],c.value.forEach((e=>{if("text"===e.type){const t=e.content.split("\n");t.forEach((e=>{e.trim()&&m.value.push({type:"line",content:e,parentType:"text"})}))}else if("task-block"===e.type||"code"===e.type){const t=e.content.split("\n");m.value.push({type:"block-start",blockType:e.type,block:e}),t.forEach((t=>{m.value.push({type:"block-line",content:t,parentType:e.type})})),m.value.push({type:"block-end",blockType:e.type})}else m.value.push({type:"whole-block",block:e})}))},R=e=>{console.log("开始解析内容块，内容长度:",e.length),g.value=[];let t=e;const a=[],l={},s=/==== Start of Task Block: ([a-zA-Z0-9-]+) ====([\s\S]*?)==== End of Task Block: \1 ====/g;let n;while(null!==(n=s.exec(t))){const e=n[1],t=n[2].trim(),s=n.index,o=n.index+n[0].length;a.push({type:"task-block",id:e,content:t,start:s,end:o});for(let a=s;a<o;a++)l[a]=!0}const o=/```(?:(?:(json))|(?:[a-zA-Z]*))\n([\s\S]*?)```/g;let i;while(null!==(i=o.exec(t))){const e=!!i[1],t=i[2],l=i.index,s=i.index+i[0].length;a.push({type:"code",content:t,isJson:e,start:l,end:s})}const r=/(- \[.*?\] .*(?:\n {2,}[^\n]+)*(?:\n(?:- \[.*?\] .*(?:\n {2,}[^\n]+)*))+)/g;let p;while(null!==(p=r.exec(t))){const e=p[0],t=p.index,l=p.index+p[0].length,s=/- \[(.*?)\] (.*?)(?:\n|$)(?:\n {2,}([^\n]+))?/g,n=[];let o;s.lastIndex=0;while(null!==(o=s.exec(e))){const e="x"===o[1].trim()?"done":"~"===o[1].trim()?"abandoned":"pending";n.push({status:e,text:o[2],detail:o[3]||""})}n.length>=2&&a.push({type:"status-group",items:n,start:t,end:l})}let u=[];for(const c of a.filter((e=>"task-block"===e.type)))u.push({type:"task-block",id:c.id,content:c.content,position:c.start});for(const c of a.filter((e=>"task-block"!==e.type))){let e=!1;const t=c.end-c.start;let a=0;for(let s=c.start;s<c.end;s++)l[s]&&a++;a/t>.7&&(e=!0,"code"===c.type&&console.log("过滤掉任务块内的代码块:",c.content.substring(0,50)+(c.content.length>50?"...":""))),e||("code"===c.type?u.push({type:"code",content:c.content,isJson:c.isJson,position:c.start}):"status-group"===c.type&&u.push({type:"status-group",items:c.items,expanded:!1,position:c.start}))}let d=0,v=!1;for(let c=0;c<t.length;c++){let e=!1;for(const t of a)if(c>=t.start&&c<t.end){e=!0;break}if(e||l[c]){if(v){const e=t.substring(d,c).trim();e&&u.push({type:"text",content:e,position:d}),v=!1}}else v||(d=c,v=!0)}if(v){const e=t.substring(d).trim();e&&u.push({type:"text",content:e,position:d})}u.sort(((e,t)=>{const a=void 0!==e.position?e.position:1/0,l=void 0!==t.position?t.position:1/0;return a-l})),u=u.map((e=>{const{position:t,...a}=e;return a}));const h=u.reduce(((e,t)=>(e[t.type]=(e[t.type]||0)+1,e)),{});console.log("解析完成，内容块总数:",u.length),console.log("各类型块数量:",h),c.value=u,w&&clearInterval(w),w=I()},A=()=>{window.scrollTo({top:0,behavior:"smooth"})},K=e=>{console.log(`预览文件: ${e.fileName}, 类型: ${e.fileType}, 路径: ${e.filePath}`),"image"===e.fileType?M(e):f.value=e,v.value&&(v.value=null)},M=e=>{const t=[e.filePath,`/${e.filePath}`,`/storyteller/output/iterations/iteration_1/charts/${e.fileName}`,`/storyteller/output/iterations/iteration_2/charts/${e.fileName}`,`/storyteller/output/iterations/iteration_3/charts/${e.fileName}`,`/storyteller/output/visualizations/${e.fileName}`,`/storyteller/output/images/${e.fileName}`,`/storyteller/output/charts/${e.fileName}`];console.log(`尝试加载图片: ${e.fileName}，共${t.length}个可能路径`),j(t,0,e)},j=(e,t,a)=>{if(t>=e.length)return void console.error(`无法加载图片，所有路径都失败: ${a.fileName}`);const l=new Image;l.onload=()=>{console.log(`图片在替代路径加载成功: ${e[t]}`),a.filePath=e[t],f.value=a},l.onerror=()=>{j(e,t+1,a)},l.src=e[t]},B=()=>{f.value=null},H=async()=>{console.log("开始扫描本地目录下的文件..."),g.value=[];const e=[];try{const t=["/storyteller/output/iterations/iteration_1/charts","/storyteller/output/iterations/iteration_1/reports","/storyteller/output/iterations/iteration_2/charts","/storyteller/output/iterations/iteration_3/charts"],a=async(e,t={},a=1e3)=>{const l=new AbortController,s=setTimeout((()=>l.abort()),a);try{const a=await fetch(e,{...t,signal:l.signal});return clearTimeout(s),a}catch(n){throw clearTimeout(s),n}},l=["/storyteller/output/iterations/iteration_1/reports/report.md","/storyteller/output/iterations/iteration_1/report.md","/storyteller/output/iterations/iteration_1/reports/summary.md","/storyteller/output/iterations/iteration_2/reports/report.md"],s=l.map((async t=>{try{const l=await a(t,{method:"HEAD"},800);if(l.ok){console.log(`找到报告文件: ${t}`);const a=t.split("/").pop();return e.push({fileName:a,filePath:t,fileType:"markdown",priority:1}),!0}}catch(l){}return!1}));await Promise.all(s);const n=["/storyteller/output/iterations/iteration_1/charts/Comparison of purchase amount by gender.png","/storyteller/output/iterations/iteration_1/charts/Comparison of product category preferences across different age groups.png","/storyteller/output/iterations/iteration_1/charts/Analysis of correlation between purchase amount and previous purchases.png","/storyteller/output/iterations/iteration_1/charts/Customer segmentation based on purchase behavior.png","/storyteller/output/iterations/iteration_1/charts/AgeDistribution.png","/storyteller/output/iterations/iteration_1/charts/GenderDistribution.png","/storyteller/output/iterations/iteration_1/charts/PurchaseAmountDistribution.png","/storyteller/output/iterations/iteration_1/charts/CategoryPreference.png","/storyteller/output/iterations/iteration_1/charts/CustomerSegmentation.png"],o=n.map((async t=>{try{const l=await a(t,{method:"HEAD"},800);if(l.ok){console.log(`找到图表文件: ${t}`);const a=t.split("/").pop();return e.push({fileName:a,filePath:t,fileType:"image",priority:2}),!0}}catch(l){}return!1}));await Promise.all(o);const i=e.filter((e=>"markdown"===e.fileType)).length,r=e.filter((e=>"image"===e.fileType)).length;if(i>=1&&r>=3)console.log("已找到足够的文件，跳过后续扫描");else{const a=t.map((t=>Q(t,e)));await Promise.all(a)}}catch(t){console.error("扫描过程中发生错误:",t)}if(e.length>0){console.log(`总共找到 ${e.length} 个文件`);const t=[],a=new Set;for(const r of e)a.has(r.filePath)||(a.add(r.filePath),t.push(r));t.sort(((e,t)=>{const a=e.priority||999,l=t.priority||999;if(a!==l)return a-l;const s={markdown:1,image:2,html:3,json:4,csv:5,text:6,other:7},n=s[e.fileType]||999,o=s[t.fileType]||999;return n-o})),g.value=t;const l={type:"text",content:`## 扫描结果\n共找到 ${t.length} 个文件:`};c.value=c.value.filter((e=>!("text"===e.type&&(e.content.includes("扫描结果")||e.content.includes("文件 ("))||"file"===e.type))),c.value.push(l);const s=t.filter((e=>"image"===e.fileType)),n=t.filter((e=>["markdown","html","text"].includes(e.fileType))),o=t.filter((e=>["json","csv"].includes(e.fileType))),i=t.filter((e=>!["image","markdown","html","text","json","csv"].includes(e.fileType)));if(n.length>0){c.value.push({type:"text",content:`### 文档文件 (${n.length}个)`});for(const e of n)c.value.push({type:"file",fileName:e.fileName,filePath:e.filePath,fileType:e.fileType});setTimeout((()=>{const e=n.find((e=>"report.md"===e.fileName.toLowerCase()||e.fileName.toLowerCase().includes("report")&&"markdown"===e.fileType));if(e)console.log("找到report.md文件，自动显示在右侧面板",e),K(e);else{const e=n.find((e=>"markdown"===e.fileType));e&&(console.log("未找到report.md文件，显示第一个可用的Markdown文件",e),K(e))}}),500)}if(s.length>0){c.value.push({type:"text",content:`### 图片文件 (${s.length}个)`});for(const e of s)c.value.push({type:"file",fileName:e.fileName,filePath:e.filePath,fileType:e.fileType})}if(o.length>0){c.value.push({type:"text",content:`### 数据文件 (${o.length}个)`});for(const e of o)c.value.push({type:"file",fileName:e.fileName,filePath:e.filePath,fileType:e.fileType})}if(i.length>0){c.value.push({type:"text",content:`### 其他文件 (${i.length}个)`});for(const e of i)c.value.push({type:"file",fileName:e.fileName,filePath:e.filePath,fileType:e.fileType})}p.value=[...c.value]}else{console.log("没有找到任何文件");const e={type:"text",content:"## 扫描结果\n未找到任何文件。请检查文件路径是否正确，或者尝试其他路径。"};c.value=c.value.filter((e=>!("text"===e.type&&(e.content.includes("扫描结果")||e.content.includes("文件 ("))||"file"===e.type))),c.value.push(e),p.value=[...c.value]}},Q=async(e,t)=>{let a=[];a=e.includes("charts")?["png","jpg","svg"]:e.includes("reports")?["md","html"]:["md","html","png","jpg"];const l=[];if((a.includes("md")||a.includes("html"))&&l.push(...["report.md","summary.md","analysis.md","index.html","report.html"].filter((e=>a.includes(e.split(".").pop())))),a.includes("png")||a.includes("jpg")||a.includes("svg"))for(let n=1;n<=5;n++)for(const e of a.filter((e=>["png","jpg","svg"].includes(e))))l.push(`chart_${n}.${e}`),l.push(`figure_${n}.${e}`);const s=l.map((async a=>{const l=`${e}/${a}`;try{const e=await O(l,{method:"HEAD"},800);if(e.ok){console.log(`找到文件: ${l}`);const e=a.split(".").pop().toLowerCase();let s=q(e);return t.push({fileName:a,filePath:l,fileType:s,priority:"markdown"===s?1:"image"===s?2:3}),!0}}catch(s){}return!1}));await Promise.all(s)},O=async(e,t={},a=1e3)=>{const l=new AbortController,s=setTimeout((()=>l.abort()),a);try{const a=await fetch(e,{...t,signal:l.signal});return clearTimeout(s),a}catch(n){throw clearTimeout(s),n}},q=e=>["png","jpg","jpeg","gif","svg"].includes(e)?"image":"md"===e?"markdown":"html"===e?"html":["json","csv"].includes(e)?e:"txt"===e?"text":"other";return{query:e,isDatasetPreviewVisible:t,datasetHeaders:a,datasetRows:l,isLoading:n,datasetError:o,fullScreenImage:i,introContent:r,contentBlocks:c,displayedBlocks:p,isTypingComplete:u,typingSpeed:d,selectedCodeBlock:v,selectCodeBlock:C,closeCodeDetail:b,getCodePreview:L,formatTextWithHighlights:T,openFullScreenImage:E,closeFullScreenImage:x,toggleDatasetPreview:P,loadDataset:$,showBackToTop:h,scrollToTop:A,skipTypingAnimation:S,selectedFile:f,selectFile:K,closeFilePreview:B,scanIterationsDirectory:H}}};const nt=(0,Q.A)(st,[["render",_],["__scopeId","data-v-eaa257ba"]]);var ot=nt,it=(0,s.pM)({name:"App",components:{ChatPage:ot}});const rt=(0,Q.A)(it,[["render",o]]);var ct=rt;(0,l.Ef)(ct).mount("#app")}},t={};function a(l){var s=t[l];if(void 0!==s)return s.exports;var n=t[l]={exports:{}};return e[l].call(n.exports,n,n.exports,a),n.exports}a.m=e,function(){var e=[];a.O=function(t,l,s,n){if(!l){var o=1/0;for(p=0;p<e.length;p++){l=e[p][0],s=e[p][1],n=e[p][2];for(var i=!0,r=0;r<l.length;r++)(!1&n||o>=n)&&Object.keys(a.O).every((function(e){return a.O[e](l[r])}))?l.splice(r--,1):(i=!1,n<o&&(o=n));if(i){e.splice(p--,1);var c=s();void 0!==c&&(t=c)}}return t}n=n||0;for(var p=e.length;p>0&&e[p-1][2]>n;p--)e[p]=e[p-1];e[p]=[l,s,n]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var l in t)a.o(t,l)&&!a.o(e,l)&&Object.defineProperty(e,l,{enumerable:!0,get:t[l]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={524:0};a.O.j=function(t){return 0===e[t]};var t=function(t,l){var s,n,o=l[0],i=l[1],r=l[2],c=0;if(o.some((function(t){return 0!==e[t]}))){for(s in i)a.o(i,s)&&(a.m[s]=i[s]);if(r)var p=r(a)}for(t&&t(l);c<o.length;c++)n=o[c],a.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return a.O(p)},l=self["webpackChunkweb"]=self["webpackChunkweb"]||[];l.forEach(t.bind(null,0)),l.push=t.bind(null,l.push.bind(l))}();var l=a.O(void 0,[504],(function(){return a(3944)}));l=a.O(l)})();
//# sourceMappingURL=app.ccd760cb.js.map